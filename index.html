<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>WebGL Rotating Cube 2</title>

    <link rel="stylesheet" href="style.css">

    <script id="vs" type="x-shader/x-vertex">
        precision highp float;

        attribute vec3 vertPosition; 
        attribute vec4 vertColor; 
        
        varying lowp vec4 fragColor; 
        
        uniform lowp float pointSize; 
        uniform mat4 mWorld; 
        uniform mat4 mView; 
        uniform mat4 mProj; 
        uniform float min; 
        uniform float max; 

        uniform int axis; 
        uniform float rad; 
        uniform vec3 plane1_a; 
        uniform vec3 plane1_b; 
        uniform vec3 plane1_c; 
        uniform vec3 plane2_a; 
        uniform vec3 plane2_b; 
        uniform vec3 plane2_c; 

        mat4 create_identity_matrix() {
            mat4 iden;
            iden[0] = vec4(1.0,  .0,  .0,  .0);
            iden[1] = vec4( .0, 1.0,  .0,  .0);
            iden[2] = vec4( .0,  .0, 1.0,  .0);
            iden[3] = vec4( .0,  .0,  .0, 1.0);
            return iden;
        }

        mat4 create_rotation_x_matrix(float rad) {
            mat4 rot;
            rot[0] = vec4(1.0, .0,        .0,        .0);
            rot[1] = vec4( .0, cos(rad), -sin(rad),  .0);
            rot[2] = vec4( .0, sin(rad),  cos(rad),  .0);
            rot[3] = vec4( .0, .0,        .0,       1.0);
            return rot;
        } 

        mat4 create_rotation_y_matrix(float rad) {
            mat4 rot;
            rot[0] = vec4( cos(rad),  .0, sin(rad),  .0);
            rot[1] = vec4( .0,       1.0, .0,        .0);
            rot[2] = vec4(-sin(rad),  .0, cos(rad),  .0);
            rot[3] = vec4( .0,       0.0, .0,       1.0);
            return rot;
        } 

        mat4 create_rotation_z_matrix(float rad) {
            mat4 rot;
            rot[0] = vec4(cos(rad), -sin(rad),  .0,  .0);
            rot[1] = vec4(sin(rad),  cos(rad),  .0,  .0);
            rot[2] = vec4(.0,        .0,       1.0,  .0);
            rot[3] = vec4(.0,        .0,        .0, 1.0);
            return rot;
        }

        mat4 check_vertex(vec3 vertex, int axis, float min, float max, float rad) {
            if (axis == 0) 
                if (vertex.x >= min && vertex.x <= max)
                    return create_rotation_x_matrix(rad);
                else
                    return create_identity_matrix();
            else if (axis == 1) 
                if (vertex.y >= min && vertex.y <= max)
                    return create_rotation_y_matrix(rad);
                else
                    return create_identity_matrix();
            else if (axis == 2) 
                if (vertex.z >= min && vertex.z <= max)
                    return create_rotation_z_matrix(rad); 
                else
                    return create_identity_matrix();

            return create_identity_matrix();
        }

        vec4 create_plane_from_3_points(vec3 a, vec3 b, vec3 c) {
            vec3 v1 = b.xyz - a.xyz;
            vec3 v2 = c.xyz - a.xyz;
            vec3 normal = cross(v1, v2);
            float d0 = -dot(normal, a);

            return vec4(normal, d0);
        }

        float get_dot_product_of_plane_and_vector(vec3 point, vec4 plane) {
            return dot(point.xyz, plane.xyz) + plane.w;
        }

        bool check_if_point_between_2_planes(vec3 point, vec4 plane1, vec4 plane2) {
            float dis1 = get_dot_product_of_plane_and_vector(point, plane1);
            float dis2 = get_dot_product_of_plane_and_vector(point, plane2);

            float sign1 = sign(dis1);
            float sign2 = sign(dis2);

            if (sign1 == 0.0 || sign2 == 0.0)
                return true;

            if (sign1 != sign2)
                return true;

            return false;
        }

        mat4 check_vertex2(
            vec3 points1_a, 
            vec3 points1_b, 
            vec3 points1_c, 
            vec3 points2_a, 
            vec3 points2_b, 
            vec3 points2_c, 
            vec3 vertex, 
            int axis, 
            float rad
        ) {
            vec4 plane1 = create_plane_from_3_points(points1_a, points1_b, points1_c);
            vec4 plane2 = create_plane_from_3_points(points2_a, points2_b, points2_c);
            mat4 rotation_matrix = create_identity_matrix();

            if ( check_if_point_between_2_planes(vertex, plane1, plane2) ) {
                if (axis == 0)
                    rotation_matrix = create_rotation_x_matrix(rad);
                else if (axis == 1)
                    rotation_matrix = create_rotation_y_matrix(rad);
                else if (axis == 2)
                    rotation_matrix = create_rotation_z_matrix(rad);
                else 
                    rotation_matrix = create_identity_matrix();
            } else 
                rotation_matrix = create_identity_matrix();

            return rotation_matrix;
        }
        
        void main() { 
            fragColor = vertColor;
            gl_PointSize = pointSize;

            mat4 rot = check_vertex(vertPosition, axis, min, max, rad);

            mat4 rot2 = check_vertex2(
                plane1_a, 
                plane1_b, 
                plane1_c, 
                plane2_a, 
                plane2_b, 
                plane2_c, 
                vertPosition, 
                axis, 
                rad
            );

            gl_Position = mProj * mView * mWorld * rot * vec4(vertPosition, 1.0);
        }
    </script>

    <script id="fs" type="x-shader/x-fragment">
        varying lowp vec4 fragColor; 
        
        void main() { 
            gl_FragColor = fragColor; 
        }
    </script>

    <script id="vs300" type="x-shader/x-vertex">#version 300 es 
        precision highp float; 
        
        in vec3 vertPosition; 
        in vec4 vertColor; 
        
        out vec4 fragColor; 
        
        uniform lowp float pointSize; 
        uniform mat4 mWorld; 
        uniform mat4 mView; 
        uniform mat4 mProj; 
        
        void main() { 
            fragColor = vertColor; 
            gl_PointSize = pointSize;
            gl_Position = mProj * mView * mWorld * vec4(vertPosition, 1.0); 
        }
    </script>

    <script id="fs300" type="x-shader/x-fragment">#version 300 es 
        precision highp float; 

        in vec4 fragColor; 
        out vec4 outFragColor; 
        
        void main() { 
            outFragColor = fragColor; 
        }
    </script>

    <script src="class.js"></script>
    <script src="function.js"></script>
    <script src="script.js" defer></script>
    <script src="add_event_listener.js" defer></script>
</head>

<body class="dark-mode">

    <div class="button-block">
        <button id="change-theme">Change theme</button>
        <button id="create">Create rubik's cube</button>
        <button id="toggle-rotate" class="is_stop_rotating" disabled>Start animation</button>
        <button id="scrambling">Start scrambling</button>
        <button id="show-movement-control" disabled>Hide movement control</button>
        <button id="show-control">Show control</button>
    </div>

    <main>
        <div id="controller">
            <button id="hide-control">Hide control</button>
    
            
            <p>FPS: <span id="fps"></span></p>
    
    
            <div class="dropdown">
                <p class="dropdown-trigger" onclick="show_drop_down(this)"><span>▽</span> Rubik</p>
    
                <div class="dropdown-content">
                    <div class="input-block">
                        <label for="size-x">Rubik Size X:</label>
                        <input id="size-x" type="number" min="1" max="100" value="3" size="4" step="1">
                    </div>
                    <div class="input-block">
                        <label for="size-y">Rubik Size Y:</label>
                        <input id="size-y" type="number" min="1" max="100" value="3" size="4" step="1">
                    </div>
                    <div class="input-block">
                        <label for="size-z">Rubik Size Z:</label>
                        <input id="size-z" type="number" min="1" max="100" value="3" size="4" step="1">
                    </div>
                    <div class="input-block">
                        <label for="length">Rubik Length:</label>
                        <input id="length" type="number" min="0" max="10" value="0.99999" size="4" step="0.1">
                    </div>
                    <div class="input-block">
                        <label for="sticker-gap">Sticker gap:</label>
                        <input id="sticker-gap" type="number" min="-10" max="10" value="0.01" size="4" step="0.01">
                    </div>
                    <div class="input-block">
                        <label for="sticker-size">Sticker size:</label>
                        <input id="sticker-size" type="number" min="0" max="1" value="0.9" size="4" step="0.9">
                    </div>
                </div>
            </div>
    
    
            <div class="dropdown">
                <p class="dropdown-trigger" onclick="show_drop_down(this)"><span>▽</span> Rubik Orientation</p>
    
                <div class="dropdown-content">
                    <div class="input-block">
                        <label for="orientation-x">Rubik Orientation X:</label>
                        <input id="orientation-x" type="number" min="-360" max="360" value="-0.7" size="4" step="0.1">
                    </div>
                    <div class="input-block">
                        <label for="orientation-y">Rubik Orientation Y:</label>
                        <input id="orientation-y" type="number" min="-360" max="360" value="-0.6" size="4" step="1">
                    </div>
                    <div class="input-block">
                        <label for="orientation-z">Rubik Orientation Z:</label>
                        <input id="orientation-z" type="number" min="-360" max="360" value="0" size="4" step="1">
                    </div>
                </div>
            </div>


            <div class="dropdown">
                <p class="dropdown-trigger" onclick="show_drop_down(this)"><span>▽</span> Camera</p>
    
                <div class="dropdown-content">
                    <div class="input-block">
                        <label for="camera-x">Camera position X:</label>
                        <input id="camera-x" type="number" min="-100" max="100" value="0" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="camera-y">Camera position Y:</label>
                        <input id="camera-y" type="number" min="-100" max="100" value="0" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="camera-z">Camera position Z:</label>
                        <input id="camera-z" type="number" min="-100" max="100" value="-10" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="look-at-x">Camera look at X:</label>
                        <input id="look-at-x" type="number" min="-100" max="100" value="0" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="look-at-y">Camera look at Y:</label>
                        <input id="look-at-y" type="number" min="-100" max="100" value="0" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="look-at-z">Camera look at Z:</label>
                        <input id="look-at-z" type="number" min="-100" max="100" value="0" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="up-axis-x">Up axis X:</label>
                        <input id="up-axis-x" type="number" min="-100" max="100" value="0" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="up-axis-y">Up axis Y:</label>
                        <input id="up-axis-y" type="number" min="-100" max="100" value="1" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="up-axis-z">Up axis Z:</label>
                        <input id="up-axis-z" type="number" min="-100" max="100" value="0" size="2" step="1">
                    </div>
                </div>
            </div>
    
    
            <div class="dropdown">
                <p class="dropdown-trigger" onclick="show_drop_down(this)"><span>▽</span> Rendering</p>
    
                <div class="dropdown-content">
                    <div class="input-block">
                        <label for="render-inner-cube">Render Inner cube:</label>
                        <input id="render-inner-cube" type="checkbox">
                    </div>
                    <div class="input-block">
                        <label for="render-outer-cube">Render Outer cube:</label>
                        <input id="render-outer-cube" type="checkbox" checked>
                    </div>
                    <div class="input-block">
                        <label for="render-inner-plane">Render inner plane:</label>
                        <input id="render-inner-plane" type="checkbox">
                    </div>
                    <div class="input-block">
                        <label for="draw-mode">Draw mode:</label>
                        <select name="draw-mode" id="draw-mode">
                            <option value="points">Points</option>
                            <option value="lines">Lines</option>
                            <option value="line_loop">Line Loop</option>
                            <option value="line_strip">Line Strip</option>
                            <option selected value="triangles">Triangles</option>
                            <option value="triangle_strip">Triangle Strip</option>
                            <option value="triangle_fan">Triangle Fan</option>
                        </select>
                    </div>
                    <div class="input-block">
                        <label for="point-size">Point size:</label>
                        <input id="point-size" type="number" min="0" max="1000" value="1" size="2" step="1">
                    </div>
                </div>
            </div>
    
    
            <div class="dropdown">
                <p class="dropdown-trigger" onclick="show_drop_down(this)"><span>▽</span> Animation</p>
    
                <div class="dropdown-content">
                    <div class="input-block">
                        <label for="rotate-angle-x">Rotate angle X speed:</label>
                        <input id="rotate-angle-x" type="number" min="-10" max="10" value="0" size="2" step="0.1">
                    </div>
                    <div class="input-block">
                        <label for="rotate-angle-y">Rotate angle Y speed:</label>
                        <input id="rotate-angle-y" type="number" min="-10" max="10" value="0" size="2" step="0.1">
                    </div>
                    <div class="input-block">
                        <label for="rotate-angle-z">Rotate angle Z speed:</label>
                        <input id="rotate-angle-z" type="number" min="-10" max="10" value="0" size="2" step="0.1">
                    </div>
                    <div class="input-block">
                        <label for="update-angle-1">Update angle per frame method 1:</label>
                        <input id="update-angle-1" name="update-angle-method" value="method1" type="radio" checked>
                    </div>
                    <div class="input-block">
                        <label for="update-angle-2">Update angle per frame method 2:</label>
                        <input id="update-angle-2" name="update-angle-method" value="method2" type="radio">
                    </div>
                    <div class="input-block">
                        <label for="angle-per-second">Angle per frame for method 2:</label>
                        <input id="angle-per-second" type="number" min="-360" max="360" value="90" size="2" step="0.1">
                    </div>
                    <div class="input-block">
                        <label for="smooth-rotation">Smooth rotation per frame:</label>
                        <input id="smooth-rotation" type="number" min="0" max="100" value="10" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="angle-rotated-ratio">Angle rotated ratio per frame:</label>
                        <input id="angle-rotated-ratio" type="number" min="0" max="360" value="25" size="2" step="1">
                    </div>
                </div>
            </div>
    
    
            <div class="dropdown">
                <p class="dropdown-trigger" onclick="show_drop_down(this)"><span>▽</span> Scene</p>
    
                <div class="dropdown-content">
                    <div class="input-block">
                        <label for="fovy">Field of view y (degree):</label>
                        <input id="fovy" type="number" min="-360" max="360" value="45" size="2" step="1">
                    </div>
                    <div class="input-block">
                        <label for="near">Near plane:</label>
                        <input id="near" type="number" min="-10" max="10" value="0.1" size="2" step="0.1">
                    </div>
                    <div class="input-block">
                        <label for="far">Far plane:</label>
                        <input id="far" type="number" min="-1000" max="1000" value="100" size="2" step="10">
                    </div>
                </div>
            </div>
    
    
            <div class="dropdown">
                <p class="dropdown-trigger" onclick="show_drop_down(this)"><span>▽</span> Rubik's Color</p>
    
                <div class="dropdown-content">
                    <div class="input-block">
                        <label for="top-color">Top color:</label>
                        <input id="top-color" type="color" value="#FFFFFF">
                    </div>
                    <div class="input-block">
                        <label for="bottom-color">Bottom color:</label>
                        <input id="bottom-color" type="color" value="#FFFF00">
                    </div>
                    <div class="input-block">
                        <label for="front-color">Front color:</label>
                        <input id="front-color" type="color" value="#00FF00">
                    </div>
                    <div class="input-block">
                        <label for="back-color">Back color:</label>
                        <input id="back-color" type="color" value="#0000FF">
                    </div>
                    <div class="input-block">
                        <label for="right-color">Right color:</label>
                        <input id="right-color" type="color" value="#FF0000">
                    </div>
                    <div class="input-block">
                        <label for="left-color">Left color:</label>
                        <input id="left-color" type="color" value="#FFA700">
                    </div>
                    <div class="input-block">
                        <label for="inner-color">Inner color:</label>
                        <input id="inner-color" type="color" value="#191919">
                    </div>
                    <div class="input-block">
                        <label for="transparent">Transparent:</label>
                        <input id="transparent" type="number" min="0" max="255" value="255" size="2" step="1">
                    </div>
                </div>
            </div>
    
            <div class="dropdown">
                <p class="dropdown-trigger" onclick="show_drop_down(this)"><span>▽</span> Shader Program</p>
    
                <div class="dropdown-content">
                    <div class="input-block">
                        <label for="shader-program-version">Use higher precision shader program version:</label>
                        <input id="shader-program-version" type="checkbox" size="2">
                    </div>
                </div>
            </div>
    
    
        </div>

        <canvas id="game-surface">
            Your browser does not support HTML5
        </canvas>
    
        <div id="movement-controller"></div>
    </main>
    
    </div>
</body>

</html>