<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>WebGL Rotating Cube 2</title>

    <style>
        *, button {
            font-size: 16px;
            color: #eeeeee;
            font-family: monospace;
        }
        body {
            /* margin: 0; */
            box-sizing: border-box;
            background: #000000;
            display: flex;
            gap: 1rem;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
        }
        #show-control {
            width: 90%;
            padding: 0.5rem;
        }
        canvas {
            width:  90%;
            height: 80%;
            border-radius: 10px;
        }
        #controller {
            position: absolute;
            top: 10px;
            left: -100%;
            padding: 0.25rem;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            transition: left 0.5s;
            background: #000000aa;
        }
        #rubik-controller, #orbit-controller {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        #movement-controller {
            padding: 1rem;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        input {
            padding: 0.25rem;
            background-color: #121212;
        }
        .input-block {
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        button {
            background: #121212;
        }
    </style>

    <script>
        function toRadian(a) {
            return a * Math.PI / 180;
        }

        function identity(out) {
            out[0] = 1;
            out[1] = 0;
            out[2] = 0;
            out[3] = 0;
            out[4] = 0;
            out[5] = 1;
            out[6] = 0;
            out[7] = 0;
            out[8] = 0;
            out[9] = 0;
            out[10] = 1;
            out[11] = 0;
            out[12] = 0;
            out[13] = 0;
            out[14] = 0;
            out[15] = 1;
            return out;
        }

        function rotate(out, a, rad, axis) {
            var x = axis[0],
                y = axis[1],
                z = axis[2];
            var len = Math.sqrt(x * x + y * y + z * z);
            var s = void 0,
                c = void 0,
                t = void 0;
            var a00 = void 0,
                a01 = void 0,
                a02 = void 0,
                a03 = void 0;
            var a10 = void 0,
                a11 = void 0,
                a12 = void 0,
                a13 = void 0;
            var a20 = void 0,
                a21 = void 0,
                a22 = void 0,
                a23 = void 0;
            var b00 = void 0,
                b01 = void 0,
                b02 = void 0;
            var b10 = void 0,
                b11 = void 0,
                b12 = void 0;
            var b20 = void 0,
                b21 = void 0,
                b22 = void 0;

            if (Math.abs(len) < 0.000001) {
                return null;
            }

            len = 1 / len;
            x *= len;
            y *= len;
            z *= len;

            s = Math.sin(rad);
            c = Math.cos(rad);
            t = 1 - c;

            a00 = a[0];a01 = a[1];a02 = a[2];a03 = a[3];
            a10 = a[4];a11 = a[5];a12 = a[6];a13 = a[7];
            a20 = a[8];a21 = a[9];a22 = a[10];a23 = a[11];

            // Construct the elements of the rotation matrix
            b00 = x * x * t + c;b01 = y * x * t + z * s;b02 = z * x * t - y * s;
            b10 = x * y * t - z * s;b11 = y * y * t + c;b12 = z * y * t + x * s;
            b20 = x * z * t + y * s;b21 = y * z * t - x * s;b22 = z * z * t + c;

            // Perform rotation-specific matrix multiplication
            out[0] = a00 * b00 + a10 * b01 + a20 * b02;
            out[1] = a01 * b00 + a11 * b01 + a21 * b02;
            out[2] = a02 * b00 + a12 * b01 + a22 * b02;
            out[3] = a03 * b00 + a13 * b01 + a23 * b02;
            out[4] = a00 * b10 + a10 * b11 + a20 * b12;
            out[5] = a01 * b10 + a11 * b11 + a21 * b12;
            out[6] = a02 * b10 + a12 * b11 + a22 * b12;
            out[7] = a03 * b10 + a13 * b11 + a23 * b12;
            out[8] = a00 * b20 + a10 * b21 + a20 * b22;
            out[9] = a01 * b20 + a11 * b21 + a21 * b22;
            out[10] = a02 * b20 + a12 * b21 + a22 * b22;
            out[11] = a03 * b20 + a13 * b21 + a23 * b22;

            if (a !== out) {
                // If the source and destination differ, copy the unchanged last row
                out[12] = a[12];
                out[13] = a[13];
                out[14] = a[14];
                out[15] = a[15];
            }
            return out;
        }

        function multiply(out, a, b) {
            var a00 = a[0],
                a01 = a[1],
                a02 = a[2],
                a03 = a[3];
            var a10 = a[4],
                a11 = a[5],
                a12 = a[6],
                a13 = a[7];
            var a20 = a[8],
                a21 = a[9],
                a22 = a[10],
                a23 = a[11];
            var a30 = a[12],
                a31 = a[13],
                a32 = a[14],
                a33 = a[15];

            // Cache only the current line of the second matrix
            var b0 = b[0],
                b1 = b[1],
                b2 = b[2],
                b3 = b[3];
            out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
            out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
            out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
            out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;

            b0 = b[4];b1 = b[5];b2 = b[6];b3 = b[7];
            out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
            out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
            out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
            out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;

            b0 = b[8];b1 = b[9];b2 = b[10];b3 = b[11];
            out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
            out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
            out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
            out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;

            b0 = b[12];b1 = b[13];b2 = b[14];b3 = b[15];
            out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
            out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
            out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
            out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;
            return out;
            }
    
        function lookAt(out, eye, center, up) {
            var x0 = void 0,
                x1 = void 0,
                x2 = void 0,
                y0 = void 0,
                y1 = void 0,
                y2 = void 0,
                z0 = void 0,
                z1 = void 0,
                z2 = void 0,
                len = void 0;
            var eyex = eye[0];
            var eyey = eye[1];
            var eyez = eye[2];
            var upx = up[0];
            var upy = up[1];
            var upz = up[2];
            var centerx = center[0];
            var centery = center[1];
            var centerz = center[2];

            if (Math.abs(eyex - centerx) < 0.000001 && Math.abs(eyey - centery) < 0.000001 && Math.abs(eyez - centerz) < 0.000001) {
                return identity(out);
            }

            z0 = eyex - centerx;
            z1 = eyey - centery;
            z2 = eyez - centerz;

            len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);
            z0 *= len;
            z1 *= len;
            z2 *= len;

            x0 = upy * z2 - upz * z1;
            x1 = upz * z0 - upx * z2;
            x2 = upx * z1 - upy * z0;
            len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);
            if (!len) {
                x0 = 0;
                x1 = 0;
                x2 = 0;
            } else {
                len = 1 / len;
                x0 *= len;
                x1 *= len;
                x2 *= len;
            }

            y0 = z1 * x2 - z2 * x1;
            y1 = z2 * x0 - z0 * x2;
            y2 = z0 * x1 - z1 * x0;

            len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);
            if (!len) {
                y0 = 0;
                y1 = 0;
                y2 = 0;
            } else {
                len = 1 / len;
                y0 *= len;
                y1 *= len;
                y2 *= len;
            }

            out[0] = x0;
            out[1] = y0;
            out[2] = z0;
            out[3] = 0;
            out[4] = x1;
            out[5] = y1;
            out[6] = z1;
            out[7] = 0;
            out[8] = x2;
            out[9] = y2;
            out[10] = z2;
            out[11] = 0;
            out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);
            out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);
            out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);
            out[15] = 1;

            return out;
        }

        function perspective(out, fovy, aspect, near, far) {
            var f = 1.0 / Math.tan(fovy / 2);
            var nf = 1 / (near - far);
            out[0] = f / aspect;
            out[1] = 0;
            out[2] = 0;
            out[3] = 0;
            out[4] = 0;
            out[5] = f;
            out[6] = 0;
            out[7] = 0;
            out[8] = 0;
            out[9] = 0;
            out[10] = (far + near) * nf;
            out[11] = -1;
            out[12] = 0;
            out[13] = 0;
            out[14] = 2 * far * near * nf;
            out[15] = 0;
            return out;
        }
    </script>

    <script id="vs" type="x-shader/x-vertex">
        precision lowp float;
        
        attribute vec3 vertPosition;
        attribute vec4 vertColor;

        varying vec4 fragColor;

        uniform mat4 mWorld;
        uniform mat4 mView;
        uniform mat4 mProj;
        
        void main() {
            fragColor = vertColor;
            gl_Position = mProj * mView * mWorld * vec4(vertPosition, 1.0);
        }
    </script>

    <script id="fs" type="x-shader/x-fragment">
        precision lowp float;
        
        varying vec4 fragColor;

        void main() {
            gl_FragColor = fragColor;
        }
    </script>

    <script src="script.js" defer></script>
</head>
<body>

    <button id="show-control">Show control</button>

    <canvas id="game-surface">
        Your browser does not support HTML5
    </canvas>

    <div id="controller">
        <div class="input-block">
            <p>FPS: <span id="fps"></span></p>
        </div>
        <div id="rubik-controller">
            <div class="input-block">
                <label for="size-x">Rubik Size X:</label>
                <input id="size-x" type="number" min="1" max="10" value="2" size="4" step="1">
            </div>
            <div class="input-block">
                <label for="size-y">Rubik Size Y:</label>
                <input id="size-y" type="number" min="1" max="10" value="2" size="4" step="1">
            </div>
            <div class="input-block">
                <label for="size-z">Rubik Size Z:</label>
                <input id="size-z" type="number" min="1" max="10" value="2" size="4" step="1">
            </div>
            <div class="input-block">
                <label for="length">Rubik Length:</label>
                <input id="length" type="number" min="0" max="10" value="0.75" size="4" step="0.1">
            </div>
            <div class="input-block">
                <label for="sticker-gap">Sticker gap:</label>
                <input id="sticker-gap" type="number" min="-10" max="10" value="0" size="4" step="0.1">
            </div>
            <div class="input-block">
                <input id="create" type="button" value="Create rubik's cube">
            </div>
        </div>
        <div id="orbit-controller">
            <div class="input-block">
                <input id="start" type="button" value="Start rotating" onclick="start()">
            </div>
            <div class="input-block">
                <input id="stop" type="button" value="Stop rotating" onclick="stop()">
            </div>
        </div>
        <div id="movement-controller">
            <button id="rotate-U">U</button>
            <button id="rotate-D">D</button>
            <button id="rotate-F">F</button>
            <button id="rotate-B">B</button>
            <button id="rotate-R">R</button>
            <button id="rotate-L">L</button>
        </div>
    </div>
</body>
</html>